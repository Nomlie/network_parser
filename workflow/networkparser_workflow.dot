digraph NetworkParserWorkflow {
    rankdir=TB;
    node [shape=box, style=filled, fontname="Helvetica", fontsize=12];
    edge [fontname="Helvetica", fontsize=10];

    // Nodes
    subgraph cluster_input {
        label="Input Options";
        color=lightgrey;
        style=rounded;

        VCF [label="VCF / VCF.gz\n(raw variants)", fillcolor="#FFCCBC"];
        CSV [label="CSV / TSV\n(binary matrix)", fillcolor="#E1F5FE"];
        FASTA [label="FASTA\n(alignment)", fillcolor="#E8F5E9"];
    }

    DataLoader [label="data_loader.py\n(Input Processing)", fillcolor="#FFF9C4"];

    FilterVCF [label="bcftools filtering\n(biallelic SNPs, QUAL≥30,\nGQ≥20, DP≥10, <10% missing,\nthinned ≥10bp)", fillcolor="#FFEBEE"];
    Consensus [label="bcftools consensus\n(Consensus FASTAs)", fillcolor="#E8F5E9"];
    Matrix [label="Binary SNP Matrix\n(0=ref/absent, 1=alt/present)", fillcolor="#E1F5FE"];

    Align [label="Align data & labels\n(remove invariants/duplicates)", fillcolor="#F0F4C3"];

    Discovery [label="decision_tree_builder.py\n(Feature Discovery)\nChi² + FDR + Decision Tree\nRoot & Branch markers\nEpistatic paths", fillcolor="#FFCCBC"];

    Validation [label="statistical_validator.py\n(Statistical Validation)\nBootstrap (1000)\nPermutation tests (500)", fillcolor="#E3F2FD"];

    Integration [label="network_parser.py\n(Integration)\nRank features\nBuild networks", fillcolor="#F3E5F5"];

    Networks [label="Network Outputs\n- sample_feature_network.graphml\n- interaction_graph.graphml\n- ignn_matrices.npz", fillcolor="#FFF3E0"];

    FinalReport [label="networkparser_results_*.json\nFull discovery + validation report", fillcolor="#E8F5E9"];

    Phylogeny [label="Downstream Phylogeny\n(IQ-TREE, RAxML, etc.)\nusing consensus FASTAs", fillcolor="#E0F7FA"];

    // Edges
    VCF -> DataLoader;
    CSV -> DataLoader;
    FASTA -> DataLoader;

    DataLoader -> FilterVCF [label="if VCF"];
    DataLoader -> Matrix [label="if CSV/FASTA"];
    FilterVCF -> Matrix;
    FilterVCF -> Consensus [label="if --ref-fasta provided"];
    Consensus -> Phylogeny;

    Matrix -> Align;
    Align -> Discovery;

    Discovery -> Validation;
    Validation -> Integration;

    Integration -> Networks;
    Integration -> FinalReport;

    // Styling
    {rank=same; VCF CSV FASTA}
    {rank=same; Matrix Consensus}
    {rank=same; Networks FinalReport Phylogeny}

    // Title
    labelloc="t";
    label="NetworkParser Workflow";
    fontsize=16;
    fontname="Helvetica Bold";
}