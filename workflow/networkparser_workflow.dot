digraph NetworkParser {
    // A4 portrait layout
    size="8.27,11.69";
    ratio="fill";
    margin=0.2;
    nodesep=0.35;
    ranksep=0.6;
    rankdir=TB;
    bgcolor="#F9FAFB"; // Softer neutral background

    // Global node style
    node [
        shape=rect,
        style="rounded,filled",
        fillcolor="#FFFFFF",
        fontname="Noto Sans",
        fontsize=11,
        width=1.7,
        height=0.8,
        penwidth=1.6,
        color="#CBD5E1",
        margin=0.12
    ];

    // Global edge style
    edge [
        color="#6B7280",
        penwidth=1.4,
        fontname="Noto Sans",
        fontsize=9,
        arrowsize=0.9,
        arrowhead="vee",
        style="solid"
    ];

    // ===== 1. Input Processing =====
    subgraph cluster_input {
        label="1. Input Processing";
        color="#1E40AF";
        style=filled;
        fillcolor="#DBEAFE";
        labelfontname="Noto Sans Bold";
        labelfontsize=18;
        labelfontcolor="#1E40AF";

        n1 [label="Genomic Data\n(CSV, VCF)", fillcolor="#BFDBFE", fontcolor="#1E3A8A"];
        n2 [label="Metadata\n(Phenotypes)", fillcolor="#BFDBFE", fontcolor="#1E3A8A"];
        n3 [label="Known Markers\n(Optional)", fillcolor="#BFDBFE", fontcolor="#1E3A8A"];
        n4 [label="Preprocess\n(Align data, Remove duplicates/NaNs/invariants)", fillcolor="#93C5FD", fontcolor="#1E3A8A"];
    }

    // ===== 2. Pattern Discovery =====
    subgraph cluster_pattern {
        label="2. Pattern Discovery";
        color="#15803D";
        style=filled;
        fillcolor="#DCFCE7";
        labelfontname="Noto Sans Bold";
        labelfontsize=18;
        labelfontcolor="#15803D";

        n5 [label="Chi-squared Test", fillcolor="#BBF7D0", fontcolor="#14532D"];
        n6 [label="Fisherâ€™s Exact Test", fillcolor="#BBF7D0", fontcolor="#14532D"];
        n7 [label="FDR Correction", fillcolor="#BBF7D0", fontcolor="#14532D"];
        n8 [label="Filter Features", fillcolor="#BBF7D0", fontcolor="#14532D"];
        n9 [label="Decision Tree\nConstruction", fillcolor="#86EFAC", fontcolor="#14532D"];
        n10 [label="Epistatic Interactions\nPermutation tests", fillcolor="#BBF7D0", fontcolor="#14532D"];
    }

    // ===== 3. Statistical Validation =====
    subgraph cluster_validation {
        label="3. Statistical Validation";
        color="#B45309";
        style=filled;
        fillcolor="#FEF3C7";
        labelfontname="Noto Sans Bold";
        labelfontsize=18;
        labelfontcolor="#B45309";

        n11 [label="Bootstrap Resampling", fillcolor="#FED7AA", fontcolor="#92400E"];
        n12 [label="Temporary Trees", fillcolor="#FED7AA", fontcolor="#92400E"];
        n13 [label="Stability Assessment", fillcolor="#FED7AA", fontcolor="#92400E"];
        n14 [label="Confidence Scores", fillcolor="#FDBA74", fontcolor="#92400E"];
    }

    // ===== 4. Feature Integration =====
    subgraph cluster_integration {
        label="4. Feature Integration";
        color="#6D28D9";
        style=filled;
        fillcolor="#EDE9FE";
        labelfontname="Noto Sans Bold";
        labelfontsize=18;
        labelfontcolor="#6D28D9";

        n15 [label="Ranked Features", fillcolor="#DDD6FE", fontcolor="#5B21B6"];
        n16 [label="Sample-Feature Networks", fillcolor="#DDD6FE", fontcolor="#5B21B6"];
        n17 [label="Interaction Graphs", fillcolor="#DDD6FE", fontcolor="#5B21B6"];
        n21 [label="Integrated Outputs", fillcolor="#C4B5FD", fontcolor="#5B21B6"];
    }

    // ===== 5. Output Generation =====
    subgraph cluster_output {
        label="5. Output Generation";
        color="#374151";
        style=filled;
        fillcolor="#E5E7EB";
        labelfontname="Noto Sans Bold";
        labelfontsize=18;
        labelfontcolor="#374151";

        n18 [label="Text Report", fillcolor="#D1D5DB", fontcolor="#1F2937"];
        n19 [label="JSON Output", fillcolor="#D1D5DB", fontcolor="#1F2937"];
        n20 [label="GNN Matrices", fillcolor="#D1D5DB", fontcolor="#1F2937"];
    }

    // ===== Flow Edges =====
    n1 -> n4 [label="Data", color="#1E40AF", style=dashed];
    n2 -> n4 [label="Labels", color="#1E40AF"];
    n3 -> n4 [label="Markers", color="#1E40AF", style=dotted];
    n4 -> {n5 n6} [label="Matrix", color="#1E40AF"];

    n5 -> n7 [label="p-values", color="#15803D"];
    n6 -> n7 [label="p-values", color="#15803D"];
    n7 -> n8 [label="q-values", color="#15803D"];
    n8 -> n9 [label="Features", color="#15803D"];
    n9 -> n10 [label="Tree", color="#15803D"];

    n9 -> n11 [label="Tree", color="#B45309"];
    n10 -> n11 [label="Interactions", color="#B45309"];
    n11 -> n12 [label="Subsets", color="#B45309"];
    n12 -> n13 [label="Trees", color="#B45309"];
    n13 -> n14 [label="Metrics", color="#B45309"];

    n14 -> {n15 n16 n17} [color="#6D28D9"];
    n15 -> n21 [label="Features", color="#6D28D9"];
    n16 -> n21 [label="Networks", color="#6D28D9"];
    n17 -> n21 [label="Graphs", color="#6D28D9"];

    n21 -> n18 [label="Report Data", color="#374151"];
    n21 -> n19 [label="Structured Data", color="#374151"];
    n21 -> n20 [label="Matrices", color="#374151"];
}
